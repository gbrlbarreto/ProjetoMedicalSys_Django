{% extends 'base.html' %}
{% load static %}

{% block title %} Lista de Agendamentos Arquivados {% endblock %}

{% block main %}

<style>
    body {
        background-image: url("{% static 'img/hospital_4.jpg' %}");
        background-attachment: fixed;
        background-size: cover;
    }
</style>

<div class="container person-list-container">

    <!-- Header -->
    <div class="row align-items-center mb-4" style="margin-top: 0;">
        <div class="col-4">
        </div>
        <div class="col-4 text-center">
            <h3 class="person-list-title">Lista de Agendamentos Arquivados</h3>
        </div>
        <div class="col-4 text-end">
            {% if user.is_authenticated %}
                <span class="fw-bold">Olá, {{ user.first_name }} {{ user.last_name }}</span>
                <a href="{% url 'logout' %}" class="btn btn-danger logout-btn">
                    Sair <i class="bi bi-box-arrow-right"></i>
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Botões de ação -->
    <div class="agendamento-actions text-center mt-4 mb-3">
        <a href="{% url 'agendamentos_new' %}" class="btn btn-primary btn-sm">
            <i class="bi bi-plus-circle"></i> Novo agendamento
        </a>
        <a href="{% url 'agendamentos_list' %}" class="btn btn-secondary btn-sm">
            <i class="bi bi-arrow-left-circle"></i> Voltar
        </a>
    </div>

    <!-- Campo de busca -->
    <form method="get" class="mb-4 text-center">
        <input type="text" name="busca" class="form-control w-50 d-inline"
            placeholder="Buscar por paciente, data ou status..." value="{{ request.GET.busca }}">
        <button type="submit" class="btn btn-primary btn-sm mt-2">Buscar</button>
    </form>

    <!-- Tabela -->
    <div class="card agendamento-card">
        <div class="card-body">
            <table class="table table-sm table-hover text-center align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Nome do Paciente</th>
                        <th>Data e Hora Agendada</th>
                        <th>Médico</th>
                        <th>Status</th>
                        <th colspan="2">Ações</th>
                    </tr>
                </thead>
                <tbody>
                {% for agendamento in agendamentos %}
                    {% if agendamento.arquivado %}
                        <tr>
                            <td>{{ agendamento.id }}</td>
                            <td>{{ agendamento.paciente.nome }}</td>
                            <td>{{ agendamento.data|date:"d/m/Y" }} às {{ agendamento.hora|time:"H:i" }}</td>
                            <td>Dr. {{ agendamento.medico }}</td>
                            <td>
                                {% if agendamento.status == "A Confirmar" %}
                                    <span class="badge bg-danger">{{ agendamento.status }}</span>
                                {% elif agendamento.status == "Confirmado" %}
                                    <span class="badge bg-success">{{ agendamento.status }}</span>
                                {% elif agendamento.status == "Finalizado" %}
                                    <span class="badge bg-secondary">{{ agendamento.status }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'agendamentos_update' agendamento.id %}" 
                                   class="text-primary" title="Editar">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                            </td>
                            <td>
                                <a href="{% url 'agendamentos_desarquivar' agendamento.id %}" 
                                   class="text-primary" title="Desarquivar">
                                    <i class="bi bi-plus-circle-fill"></i>
                                </a>
                            </td>
                        </tr>
                    {% endif %}
                {% empty %}
                    <tr>
                        <td colspan="7" class="text-muted">Nenhum agendamento encontrado</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>


{% endblock %}

{% block footer %}
<footer class="footer">
    <div class="text-center">
        <span class="text-muted">Desenvolvimento Web com Django</span>
    </div>
</footer>
{% endblock %}